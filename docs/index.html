<!DOCTYPE html>

<html>

  <head>
    <meta charset="UTF-8" />
    <link rel="canonical" href="https://www.hexstreamsoft.com/libraries/multiple-value-variants/" />
    <meta name="author" content="Jean-Philippe Paradis" />
    <link rel="author" href="https://abc.hexstream.xyz/" />
    <link rel="license" href="https://www.hexstreamsoft.com/UNLICENSE" />
    <meta name="description" content="Gives access to multiple-value variants of operators through one macro: multiple-value. The multiple-value mapping operators are especially useful." />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>multiple-value-variants | Libraries | HexstreamSoft</title>
    <link href="https://www.hexstreamsoft.com/css/global.css" rel="stylesheet" type="text/css" />
    <link href="https://www.hexstreamsoft.com/libraries/libraries.css" rel="stylesheet" type="text/css" />
    <script src="https://global.hexstream.dev/scripts/global.js"></script>
    <script src="https://www.hexstreamsoft.com/scripts/global.js"></script>
    <script src="https://www.hexstreamsoft.com/libraries/libraries.js" defer></script>
  </head>

  <body>

    <nav id="top-nav">

      <div class="main">

        <div class="breadcrumbs">
          <a href="https://www.hexstreamsoft.com/">HexstreamSoft</a>
          <span class="crumb"><span class="s"> » </span><a href="https://www.hexstreamsoft.com/libraries/">Libraries</a></span>
          <span class="crumb"><span class="s"> » </span><a class="here">multiple-value-variants</a></span>
        </div>

        <nav class="tabs" id="meta-nav">
          <ul>
            <li><a class="github" href="https://github.com/Hexstream/multiple-value-variants"><span>See on GitHub</span></a></li>
          </ul>
        </nav>

      </div>

      <p id="last-updated"><span>This page was last updated on </span><time datetime="2018-09-06">6 september 2018</time><span>.</span></p>

    </nav>

    <main>

      <header id="page-header">
        <h1>multiple-value-variants</h1>
      </header>

      <div class="tags contains-groups">
        <div class="group prominent">
          <span class="tag hv license">
            <span class="h">License<span>:</span></span>
            <span class="v">Public Domain</span>
          </span>
          <span class="s">, </span>
          <span class="tag hv quicklisp">
            <span class="h">Load it with Quicklisp<span>:</span></span>
            <code class="v">(ql:quickload "multiple-value-variants")</code>
          </span>
        </div>
        <div class="group">
          <span class="tag hv">
            <span class="h">Library type<span>:</span></span>
            <span class="v">Operator overlay macro</span>
          </span>
          <span class="s">, </span>
          <span class="tag hv">
            <span class="h">Project complexity<span>:</span></span>
            <span class="v">Medium</span>
          </span>
        </div>
      </div>

      <nav class="tabs" id="further-info">
        <ul>
          <li><a href="https://www.hexstreamsoft.com/libraries/releases/latest-versions/#multiple-value-variants">Latest release</a></li>
          <li><a href="https://www.hexstreamsoft.com/libraries/dependencies/#multiple-value-variants">Dependencies</a></li>
        </ul>
        <ul>
          <li><a href="https://www.hexstreamsoft.com/libraries/external-pages-xref/#multiple-value-variants">External library pages</a></li>
        </ul>
      </nav>

      <section id="introduction">

        <p><cite class="relevant">multiple-value-variants</cite> gives access to multiple-value variants of operators through one macro: <code class="relevant">multiple-value</code>. There are <a href="#built-in-variants">built-in variants</a> for some standard operators; it's easy to create your own variants for other operators. The <a href="#mapcar">multiple-value mapping operators</a> are especially useful.</p>

      </section>

      <nav class="tabs">
        <ul>
          <li><a href="#api-overview">API overview</a></li>
          <li><a href="#built-in-variants" class="inlining-node">Built-in variants</a></li>
        </ul>
      </nav>

      <section id="api-overview">

        <h1 class="breadcrumbs-bar">
          <span class="section-relative-nav">
            <a href="#api-overview" class="anchor">⚓</a>
          </span>
          <span class="breadcrumbs">
            <a href="#">multiple-value-variants</a>
            <span class="crumb"><span class="s"> » </span><a class="here">API overview</a></span>
          </span>
        </h1>

        <p>First of all, in the way of packages there's the <code class="relevant">multiple-value-variants</code> package, which is also nicknamed <code class="relevant">multiple-value-variant</code>, <code class="relevant">mv-variants</code> and <code class="relevant">mv-variant</code>. The primary exported symbol is the <code class="relevant">multiple-value</code> macro. Explicitly <code class="common-lisp">(:import-from #:multiple-value-variants #:multiple-value)</code> for normal usage. Don't <code class="common-lisp">(:use)</code>!</p>

        <p>The <code class="relevant">multiple-value-variants</code> package also exports other symbols related to creation of new multiple-value variants and querying of existing ones (documentation pending, check <a href="https://github.com/Hexstream/multiple-value-variants/blob/0556501700dbf09329f703b80814f36fe0106668/package.lisp">package.lisp</a> for a list of all exported symbols). The most important of these is <code class="relevant">mv-variant:define</code>, which is normally used to define new multiple-value variants. You should normally explicitly package-qualify this symbol.</p>

        <p>There are 2 recurring features throughout the API:</p>

        <ul>
          <li><var>identity</var> generally indicates the form to evaluate (and values to return) when an implicit <code class="relevant"><a href="#progn">(multiple-value progn)</a></code> has no forms.</li>
          <li><var>nth</var> indicates which value to test for conditionals.</li>
        </ul>

      </section>

      <section id="built-in-variants">

        <h1 class="breadcrumbs-bar">
          <span class="section-relative-nav">
            <a href="#built-in-variants" class="anchor">⚓</a>
          </span>
          <span class="breadcrumbs">
            <a href="#">multiple-value-variants</a>
            <span class="crumb"><span class="s"> » </span><a class="here">Built-in multiple-value variants</a></span>
          </span>
        </h1>

        <nav class="tabs">
          <ul>
            <li><a href="#progn">progn <i>/</i> prog1</a></li>
            <li><a href="#and">and <i>/</i> or</a></li>
            <li><a href="#cond">cond</a></li>
            <li><a href="#when">when <i>/</i> unless</a></li>
            <li><a href="#case">case <i>et al.</i> <span class="item-count">(<span>6</span>)</span></a></li>
            <li><a href="#mapcar">mapcar <i>et al.</i> <span class="item-count">(<span>4</span>)</span></a></li>
          </ul>
        </nav>

        <dl>

          <dt id="progn"><a href="#progn" class="anchor">⚓</a> <pre>Variant <dfn>progn</dfn> (&amp;key (<var>identity</var> '(values)))
  (&amp;body <var>forms</var>)</pre></dt>
          <dd>
            <p>Just like <code>progn</code>, except if there are no <var>forms</var> then the <var>identity</var> is evaluated instead.</p>
            <div class="scroll">
              <pre class="example"><code class="common-lisp">(<code class="relevant">multiple-value</code> () (<code class="relevant marker"><a href="#progn">progn</a></code> 1 2 3))
=&gt; 3</code></pre>
            </div>

            <div class="scroll">
              <pre class="example"><code class="common-lisp">(<code class="relevant">multiple-value</code> () (<code class="relevant marker"><a href="#progn">progn</a></code>))
=&gt; [no values]</code></pre>
            </div>
          </dd>

          <dt id="prog1"><a href="#prog1" class="anchor">⚓</a> <pre>Variant <dfn>prog1</dfn> ()
  (<var>result</var> &amp;body <var>body</var>)</pre></dt>
          <dd><p>This straightforwardly expands to a <code>multiple-value-prog1</code>.</p></dd>

          <dt id="and"><a href="#and" class="anchor">⚓</a> <pre>Variant <dfn>and</dfn> (&amp;key <var>identity</var> (<var>nth</var> 0))
  (&amp;rest <var>forms</var>)</pre></dt>
          <dd>
            <p>If <var>identity</VAR> is not specified, then there must be at least one <var>form.</var></p>
            <p>This is like normal <code>and</code>, except if one of the non-last <var>forms</var>' <var>nth</var>-value is <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_f.htm#false">false</a>, returns all values that were returned by that <var>form</var>, not just the <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_p.htm#primary_value">primary value</a>.</p>
            <div class="scroll">
              <pre class="example"><code class="common-lisp">(<code class="relevant">multiple-value</code> ()
  (<code class="relevant marker"><a href="#and">and</a></code> (values <code>nil</code> 'other 'values)
       t))
=&gt; <code>NIL</code>, OTHER, VALUES</code></pre>
            </div>
          </dd>

          <dt id="or"><a href="#or" class="anchor">⚓</a>  <pre>Variant <dfn>or</dfn> (&amp;key <var>identity</var> (<var>nth</var> 0))
  (&amp;rest <var>forms</var>)</pre></dt>
          <dd>
            <p>If <var>identity</var> is not specified, then there must be at least one <var>form</var>.</p>
            <p>This is like normal <code>or</code>, except if one of the non-last <var>forms</var>' <var>nth</var>-value is true, returns all values that were returned by that <var>form</var>, not just the <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_p.htm#primary_value">primary value</a>.</p>
            <div class="scroll">
              <pre class="example"><code class="common-lisp">(<code class="relevant">multiple-value</code> ()
  (<code class="relevant marker"><a href="#or">or</a></code> (<code>find-symbol</code> <code class="string">"OR"</code> '#:cl)
      (<code>find-symbol</code> <code class="string">"XOR"</code> '#:cl)))
=&gt; OR, :EXTERNAL</code></pre>
            </div>
          </dd>

          <dt id="cond"><a href="#cond" class="anchor">⚓</a>  <pre>Variant <dfn>cond</dfn> (&amp;key (<var>nth</var> 0))
  (&amp;rest <var>clauses</var>)</pre></dt>
          <dd>
            <p>This is just like normal <code>cond</code>, except:</p>
            <ul>
              <li><p>If a <var>clause</var> that has no <var>forms</var> succeeds, then all the values that were returned by the <var>test-form</var> are returned, not just the <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_p.htm#primary_value">primary value</a>;</p></li>
              <li><p>If no <var>clause</var> succeeds, then no values are returned (instead of <code>nil</code>).</p></li>
            </ul>
            <div class="scroll">
              <pre class="example"><code class="common-lisp">(let ((<var>hash</var> (make-hash-table)))
  (<code class="relevant">multiple-value</code> () (<code class="relevant marker"><a href="#cond">cond</a></code> ((gethash 'key <var>hash</var>))
                           ((values)))))
=&gt; [no values]</code></pre>
            </div>
            <div class="scroll">
              <pre class="example"><code class="common-lisp">(let ((<var>hash</var> (make-hash-table)))
  (setf (gethash 'key <var>hash</var>) 'value)
  (<code class="relevant">multiple-value</code> () (<code class="relevant marker"><a href="#cond">cond</a></code> ((gethash 'key <var>hash</var>))
                           ((values)))))
=&gt; VALUE, T</code></pre>
            </div>
          </dd>

          <dt id="when"><a href="#when" class="anchor">⚓</a>  <pre>Variant <dfn>when</dfn> (&amp;key (<var>else</var> '(values)) (<var>identity</var> '(values)))
  (<var>test</var> &amp;body <var>forms</var>)</pre></dt>
          <dd>
            <p>If <var>test</var> evaluates to true, evaluate <var>forms</var> as an implicit <code class="relevant"><a href="#progn">(multiple-value progn)</a></code> with <var>identity</var> as the identity.</p>
            <p>Else, evaluate <var>else</var>.</p>
            <div class="scroll">
              <pre class="example"><code class="common-lisp">(<code class="relevant">multiple-value</code> ()
  (<code class="relevant marker"><a href="#when">when</a></code> <code>nil</code>
    (print <code class="string">"side-effect"</code>)))
=&gt; [no values]</code></pre>
            </div>
          </dd>

          <dt id="unless"><a href="#unless" class="anchor">⚓</a> <pre>Variant <dfn>unless</dfn> (&amp;key (<var>else</var> '(values)) (<var>identity</var> '(values)))
  (<var>test</var> &amp;body <var>forms</var>)</pre></dt>
          <dd>
            <p>If <var>test</var> evaluates to false, evaluate <var>forms</var> as an implicit <code class="relevant"><a href="#progn">(multiple-value progn)</a></code> with <var>identity</var> as the identity.</p>
            <p>Else, evaluate <var>else</var>.</p>
          </dd>

          <dt id="case"><a href="#case" class="anchor">⚓</a> <pre>Variant <dfn>case</dfn> () (<var>keyform</var> &amp;body <var>cases</var>)</pre></dt>
          <dt id="ccase"><a href="#ccase" class="anchor">⚓</a> <pre>Variant <dfn>ccase</dfn> () (<var>keyplace</var> &amp;body <var>cases</var>)</pre></dt>
          <dt id="ecase"><a href="#ecase" class="anchor">⚓</a> <pre>Variant <dfn>ecase</dfn> () (<var>keyform</var> &amp;body <var>cases</var>)</pre></dt>
          <dt id="typecase"><a href="#typecase" class="anchor">⚓</a> <pre>Variant <dfn>typecase</dfn> () (<var>keyform</var> &amp;body <var>cases</var>)</pre></dt>
          <dt id="ctypecase"><a href="#ctypecase" class="anchor">⚓</a> <pre>Variant <dfn>ctypecase</dfn> () (<var>keyplace</var> &amp;body <var>cases</var>)</pre></dt>
          <dt id="etypecase"><a href="#etypecase" class="anchor">⚓</a> <pre>Variant <dfn>etypecase</dfn> () (<var>keyform</var> &amp;body <var>cases</var>)</pre></dt>
          <dd><p>These are like their normal counterparts, except the <var>forms</var> in each case is an implicit <code class="relevant"><a href="#progn">(multiple-value progn)</a></code>, and if no <var>case</var> matches in <code class="relevant">case</code> or <code class="relevant">typecase</code>, then no values are returned (instead of <code>nil</code>).</p></dd>

          <dt id="mapcar"><a href="#mapcar" class="anchor">⚓</a> <pre>Variant <dfn>mapcar</dfn> (<var>multiple-values-count</var>)
  (<var>function</var> &amp;rest+ <var>lists</var>)</pre></dt>
          <dt id="mapcan"><a href="#mapcan" class="anchor">⚓</a> <pre>Variant <dfn>mapcan</dfn> (<var>multiple-values-count</var>)
  (<var>function</var> &amp;rest+ <var>lists</var>)</pre></dt>
          <dt id="maplist"><a href="#maplist" class="anchor">⚓</a> <pre>Variant <dfn>maplist</dfn> (<var>multiple-values-count</var>)
  (<var>function</var> &amp;rest+ <var>lists</var>)</pre></dt>
          <dt id="mapcon"><a href="#mapcon" class="anchor">⚓</a> <pre>Variant <dfn>mapcon</dfn> (<var>multiple-values-count</var>)
  (<var>function</var> &amp;rest+ <var>lists</var>)</pre></dt>
          <dd>
            <p>These are just like the <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_mapc_.htm">normal variants</a>, except they can accumulate multiple results at the same time. This is especially useful to "triage" values (ex: split the elements of a list into 2 lists according to some criteria), and to accumulate multiple "layers" of values in one pass for macroexpansions, as an alternative to repeated mapping (sometimes with some readability problems due to reduced "correlation").</p>
            <p><var>multiple-values-count</var> is not evaluated, and must be a non-negative integer indicating the number of results (values) to accumulate and return. <var>function</var> would normally return that many values. If <var>function</var> returns less than <var>multiple-values-count</var> values, then the remaining values are <code>nil</code>. If <var>function</var> returns more than <var>multiple-values-count</var> values, then the excess values are ignored.</p>
            <div class="scroll">
              <pre class="example"><code class="common-lisp">(<code class="relevant">multiple-value</code> (2)
  (<code class="relevant marker"><a href="#mapcar">mapcar</a></code> #'truncate '(3 5/4 5.5)))
=&gt; (3 1 5), (0 1/4 0.5)</code></pre>
            </div>
            <div class="scroll">
              <pre class="example"><code class="common-lisp">(<code class="relevant">multiple-value</code> 2
  (<code class="relevant marker"><a href="#mapcan">mapcan</a></code> (lambda (<var>object</var>)
            (if (numberp <var>object</var>)
                (values (list <var>object</var>) <code>nil</code>)
                (values <code>nil</code> (list <var>object</var>))))
          '(0 a 2 3/4 c)))
=&gt; (0 2 3/4), (A C)</code></pre>
            </div>

            <div class="scroll">
              <pre class="example"><code class="common-lisp">(<code class="relevant">multiple-value</code> 3
  (<code class="relevant marker"><a href="#maplist">maplist</a></code> (lambda (<var>tail</var>)
             (values <var>tail</var>
                     (reverse <var>tail</var>)
                     (list (first <var>tail</var>) (second <var>tail</var>))))
           '(a b c d e)))
=&gt;
((A B C D E) (B C D E) (C D E) (D E) (E))
((E D C B A) (E D C B) (E D C) (E D) (E))
((A B) (B C) (C D) (D E) (E NIL))</code></pre>
            </div>

          </dd>

        </dl>

      </section>

    </main>

    <footer id="footer">
      <div class="back-to-top left">
        <a href="#">⬆</a>
      </div>
      <div class="main">
        <a href="https://validator.w3.org/check?uri=http%3A%2F%2Fwww.hexstreamsoft.com%2Flibraries%2Fmultiple-value-variants%2F">✔ HTML5</a>
        <a href="https://www.hexstreamsoft.com/README">✔ Public Domain</a>
        <a href="https://jigsaw.w3.org/css-validator/validator?uri=http%3A%2F%2Fwww.hexstreamsoft.com%2Flibraries%2Fmultiple-value-variants%2F">✔ CSS3</a>
        <a>✔ Mobile-friendly</a>
      </div>
      <div class="back-to-top right">
        <a href="#">⬆</a>
      </div>
    </footer>

  </body>
</html>
